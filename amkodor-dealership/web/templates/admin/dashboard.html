<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ê–º–∫–æ–¥–æ—Ä</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
<div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>–ê–ú–ö–û–î–û–†</h2>
            <p>–ê–≤—Ç–æ—Å–∞–ª–æ–Ω</p>
        </div>
        <nav class="sidebar-nav">
            <a href="/admin/dashboard" class="nav-item active">
                <span class="icon">üìä</span>
                –î–∞—à–±–æ—Ä–¥
            </a>
            <a href="/admin/vehicles" class="nav-item">
                <span class="icon">üöú</span>
                –¢–µ—Ö–Ω–∏–∫–∞
            </a>
            <a href="/admin/sales" class="nav-item">
                <span class="icon">üí∞</span>
                –ü—Ä–æ–¥–∞–∂–∏
            </a>
            <a href="/admin/customers" class="nav-item">
                <span class="icon">üë•</span>
                –ö–ª–∏–µ–Ω—Ç—ã
            </a>
            <a href="/admin/employees" class="nav-item">
                <span class="icon">üëî</span>
                –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
            </a>
            <a href="/admin/service" class="nav-item">
                <span class="icon">üîß</span>
                –°–µ—Ä–≤–∏—Å
            </a>
            <a href="/admin/reports" class="nav-item">
                <span class="icon">üìà</span>
                –û—Ç—á–µ—Ç—ã
            </a>
            <a href="/admin/settings" class="nav-item">
                <span class="icon">‚öôÔ∏è</span>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </a>
        </nav>
        <div class="sidebar-footer">
            <button onclick="logout()" class="btn-logout">–í—ã—Ö–æ–¥</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="main-header">
            <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <div class="user-info">
                <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <div class="user-avatar">üë§</div>
            </div>
        </header>

        <!-- Statistics Cards -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üöú</div>
                <div class="stat-info">
                    <h3>–¢–µ—Ö–Ω–∏–∫–∞ –≤ –Ω–∞–ª–∏—á–∏–∏</h3>
                    <p class="stat-value" id="availableVehicles">-</p>
                    <span class="stat-label">–µ–¥–∏–Ω–∏—Ü</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3>–ü—Ä–æ–¥–∞–∂ –∑–∞ –º–µ—Å—è—Ü</h3>
                    <p class="stat-value" id="salesLastMonth">-</p>
                    <span class="stat-label">—Å–¥–µ–ª–æ–∫</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-info">
                    <h3>–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</h3>
                    <p class="stat-value" id="revenueLastMonth">-</p>
                    <span class="stat-label">BYN</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <h3>–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                    <p class="stat-value" id="totalCustomers">-</p>
                    <span class="stat-label">—á–µ–ª.</span>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-card">
                <h3>–ü—Ä–æ–¥–∞–∂–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                <canvas id="salesChart"></canvas>
            </div>

            <div class="chart-card">
                <h3>–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                <canvas id="categoriesChart"></canvas>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="activity-section">
            <div class="activity-card">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏</h3>
                <div id="recentSales" class="activity-list">
                    <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>

            <div class="activity-card">
                <h3>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤—ã</h3>
                <div id="upcomingTestDrives" class="activity-list">
                    <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
        </section>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/api.js"></script>
<script src="/static/js/charts.js"></script>
<script src="/static/js/admin.js"></script>
<script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async () => {
        await loadDashboardData();
    });

    async function loadDashboardData() {
        try {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const stats = await API.get('/admin/dashboard');

            document.getElementById('availableVehicles').textContent = stats.available_vehicles || 0;
            document.getElementById('salesLastMonth').textContent = stats.sales_last_month || 0;
            document.getElementById('revenueLastMonth').textContent = formatCurrency(stats.revenue_last_month || 0);
            document.getElementById('totalCustomers').textContent = stats.total_customers || 0;

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
            const chartData = await API.get('/admin/dashboard/charts');
            renderCharts(chartData);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–æ–¥–∞–∂
            await loadRecentSales();

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç-–¥—Ä–∞–π–≤–æ–≤
            await loadUpcomingTestDrives();

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
        }
    }

    async function loadRecentSales() {
        try {
            const sales = await API.get('/admin/sales?limit=5');
            const container = document.getElementById('recentSales');

            if (!sales || sales.length === 0) {
                container.innerHTML = '<p class="empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            container.innerHTML = sales.map(sale => `
                    <div class="activity-item">
                        <div class="activity-icon">üí∞</div>
                        <div class="activity-content">
                            <p class="activity-title">${sale.model_name}</p>
                            <p class="activity-desc">${sale.client_name} - ${formatCurrency(sale.final_price)}</p>
                            <p class="activity-time">${formatDate(sale.sale_date)}</p>
                        </div>
                    </div>
                `).join('');
        } catch (error) {
            console.error('Error loading recent sales:', error);
        }
    }

    async function loadUpcomingTestDrives() {
        try {
            const testDrives = await API.get('/admin/test-drives?limit=5&status=–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω');
            const container = document.getElementById('upcomingTestDrives');

            if (!testDrives || testDrives.length === 0) {
                container.innerHTML = '<p class="empty">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            container.innerHTML = testDrives.map(td => `
                    <div class="activity-item">
                        <div class="activity-icon">üöó</div>
                        <div class="activity-content">
                            <p class="activity-title">${td.model_name}</p>
                            <p class="activity-desc">${td.client_name}</p>
                            <p class="activity-time">${formatDateTime(td.scheduled_date)}</p>
                        </div>
                    </div>
                `).join('');
        } catch (error) {
            console.error('Error loading test drives:', error);
        }
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/login';
    }
</script>
</body>
</html> renderCharts(data) {
// –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ –ø–æ –º–µ—Å—è—Ü–∞–º
const salesCtx = document.getElementById('salesChart').getContext('2d');
new Chart(salesCtx, {
type: 'line',
data: {
labels: data.months || [],
datasets: [{
label: '–ü—Ä–æ–¥–∞–∂–∏',
data: data.sales || [],
borderColor: '#2563eb',
backgroundColor: 'rgba(37, 99, 235, 0.1)',
tension: 0.4
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
display: false
}
}
}
});

// –ì—Ä–∞—Ñ–∏–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
new Chart(categoriesCtx, {
type: 'doughnut',
data: {
labels: data.categories || [],
datasets: [{
data: data.category_sales || [],
backgroundColor: [
'#2563eb',
'#10b981',
'#f59e0b',
'#ef4444',
'#8b5cf6'
]
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'bottom'
}
}
}
});
}

function formatCurrency(value) {
return new Intl.NumberFormat('ru-BY', {
style: 'decimal',
minimumFractionDigits: 2,
maximumFractionDigits: 2
}).format(value);
}

function formatDate(date) {
return new Date(date).toLocaleDateString('ru-BY');
}

function formatDateTime(date) {
return new Date(date).toLocaleString('ru-BY');
}

function showError(message) {
alert(message); // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–æ–ª–µ–µ –∫—Ä–∞—Å–∏–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
}

function